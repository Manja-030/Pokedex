let pokemonRepository = (function() {
  let t = [],
    e = "https://pokeapi.co/api/v2/pokemon/?limit=1000";
  function o() {
    document.querySelector(".loading-message").classList.add("visible");
  }
  function n() {
    document.querySelector(".loading-message").classList.remove("visible");
  }
  function i(e) {
    t.push(e);
  }
  function l(t) {
    pokemonRepository.loadDetails(t).then(function() {
      c(t);
    });
  }
  function c(t) {
    let e = $(".modal-body"),
      o = $(".modal-title");
    o.empty(), e.empty();
    let n = $("<h1>" + t.name + "</h1>"),
      i = $(
        "<img class='modal-img float-right img-fluid' style='max-width:200px'>"
      );
    i.attr("src", t.image), i.attr("alt", "picture of " + t.name);
    let l = $("<p>Height: " + t.height / 10 + "m</p>"),
      c = $("<p>Weight: " + t.weight / 10 + "kg</p>"),
      a = $("<p>Types: " + t.types + "</p>"),
      s = $("<p>Abilities: " + t.abilities + "</p>");
    o.append(n),
      e.append(i),
      e.append(l),
      e.append(c),
      e.append(a),
      e.append(s);
  }
  let a = document.querySelector("#searchBar");
  return (
    a.addEventListener("input", function() {
      let t = document.querySelectorAll("li"),
        e = a.value.toUpperCase();
      t.forEach(function(t) {
        t.innerText.toUpperCase().indexOf(e) > -1
          ? (t.style.display = "block")
          : (t.style.display = "none");
      });
    }),
    {
      add: i,
      getAll: function() {
        return t;
      },
      addListItem: function(t) {
        let e = document.querySelector(".pokemon-list");
        e.classList.add("row", "col-gap");
        let o = document.createElement("li");
        o.classList.add(
          "list-group-item-mine",
          "col-xl-3",
          "col-lg-4",
          "col-md-6"
        );
        let n = document.createElement("button");
        (n.innerText = t.name),
          n.classList.add("pokemon-button", "btn", "text-capitalize"),
          n.setAttribute("data-target", "#pokemonModal"),
          n.setAttribute("data-toggle", "modal"),
          o.appendChild(n),
          e.appendChild(o),
          n.addEventListener("click", function() {
            l(t);
          });
      },
      loadList: function() {
        return (
          o(),
          fetch(e)
            .then(function(t) {
              return t.json();
            })
            .then(function(t) {
              n(),
                t.results.forEach(function(t) {
                  i({ name: t.name, detailsUrl: t.url });
                });
            })
            .catch(function(t) {
              n(), console.error(t);
            })
        );
      },
      loadDetails: function(t) {
        o();
        let e = t.detailsUrl;
        return fetch(e)
          .then(function(t) {
            return t.json();
          })
          .then(function(e) {
            n(),
              (t.image = e.sprites.other.dream_world.front_default),
              (t.height = e.height),
              (t.weight = e.weight),
              (t.types = []),
              (t.abilities = []),
              Object.keys(e.types).forEach(function(o) {
                t.types.push(e.types[o].type.name);
              }),
              Object.keys(e.abilities).forEach(function(o) {
                t.abilities.push(e.abilities[o].ability.name);
              });
          })
          .catch(function(t) {
            n(), console.error(t);
          });
      },
      showDetails: l,
      showModal: c
    }
  );
})();
pokemonRepository.loadList().then(function() {
  pokemonRepository.getAll().forEach(function(t) {
    pokemonRepository.addListItem(t);
  });
});
let myButton = document.getElementById("btn-back-to-top");
function scrollFunction() {
  document.body.scrollTop > 50 || document.documentElement.scrollTop > 50
    ? (myButton.style.display = "block")
    : (myButton.style.display = "none");
}
function backToTop() {
  (document.body.scrollTop = 0), (document.documentElement.scrollTop = 0);
}
(window.onscroll = function() {
  scrollFunction();
}),
  myButton.addEventListener("click", backToTop);
